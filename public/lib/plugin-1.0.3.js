(()=>{"use strict";var e={n:o=>{var n=o&&o.__esModule?()=>o.default:()=>o;return e.d(n,{a:n}),n},d:(o,n)=>{for(var a in n)e.o(n,a)&&!e.o(o,a)&&Object.defineProperty(o,a,{enumerable:!0,get:n[a]})},o:(e,o)=>Object.prototype.hasOwnProperty.call(e,o)};const o=JSON.parse('{"UU":"@xdb/plugin","rE":"1.0.3"}'),n=(React,antd),a=dayjs;var t=e.n(a);const s=qiniu,i=window.__app__,r=i.xrequest;i.get("contexts.app");const l={name:"\u4e03\u725b\u4e91\u4e0a\u4f20",description:"\u5c06\u56fe\u7247\u3001\u6587\u4ef6\u7b49\u8d44\u6e90\u4e0a\u4f20\u5230\u4e03\u725b\u4e91CDN",moduleKey:"plugin_qiniu_cdn_upload",version:"1.0.0",install:function(){},env:{},attributes:{status:!1},settings:[{component:"BasicInput",variable:!1,formItemProps:{label:"AccessKey",name:["AccessKey"],rules:[{required:!0,message:"\u8bf7\u8f93\u5165"}]},props:{}},{component:"BasicInput",variable:!1,formItemProps:{label:"SecretKey",name:["SecretKey"],rules:[{required:!0,message:"\u8bf7\u8f93\u5165"}]},props:{}},{component:"BasicInput",variable:!1,formItemProps:{label:"\u5b58\u50a8\u6876",name:["bucket"],rules:[{required:!0,message:"\u8bf7\u8f93\u5165"}]},props:{}},{component:"BasicInput",variable:!1,formItemProps:{label:"\u52a0\u901f\u57df\u540d",name:["domain"],rules:[{required:!0,message:"\u8bf7\u8f93\u5165"}]},props:{}}],handles:{},uploadFileRequest:e=>{var o,a;const l=i.get("datas.project_id"),u=null===e||void 0===e?void 0:e.file,d=null!==u&&void 0!==u&&null!==(o=u.name)&&void 0!==o&&o.includes(".")?null===u||void 0===u||null===(a=u.name)||void 0===a?void 0:a.split(".").pop():"",c="oss/".concat(l||"platform","/").concat(t()().format("YYYYMMDD"),"/"),p=(null===e||void 0===e||e.action,null===e||void 0===e||e.headers,null===e||void 0===e||e.data,null===e||void 0===e||e.onProgress,null===e||void 0===e?void 0:e.onSuccess),m=null===e||void 0===e?void 0:e.onError;return new Promise((async(e,o)=>{if(!u)return n.message.warning("\u65e0\u4e0a\u4f20\u6587\u4ef6"),void o();const a=i.get("contexts.app").projectInfo.configs||{},t=await new Promise((async(e,o)=>{const n=await r.post("/api/core/plugin/qiniu/cdn_token",{});var a;n?e(null===(a=n.data)||void 0===a?void 0:a.token):o()})),l=c+i.uuid("",8)+(d?".".concat(d):"");s.upload(u,l,t,{customVars:{}},{}).subscribe({next:e=>{},error:e=>{null===m||void 0===m||m({data:e},{data:e}),o()},complete:o=>{const n={provider:"qiniu_cdn",name:o.filename,mime_type:o.mime_type,size:o.size,url:"".concat(a.upload.domain,"/").concat(o.key)};null===p||void 0===p||p({data:n}),e({data:n})}})}))}};window.__app__.use({name:o.UU,version:o.rE,apis:{},plugins:{[l.moduleKey]:l},routers:[],contexts:{}})})();